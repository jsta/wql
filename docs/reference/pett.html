<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Nonparametric Change-Point Detection — pett • wql</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Nonparametric Change-Point Detection — pett" />
<meta property="og:description" content="Locates a single change-point in an annual series based on the Pettitt test." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wql</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/wql-package.html">wql: Exploring water quality monitoring data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jsta/wql/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Nonparametric Change-Point Detection</h1>
    <small class="dont-index">Source: <a href='https://github.com/jsta/wql/blob/master/R/pett.R'><code>R/pett.R</code></a></small>
    <div class="hidden name"><code>pett.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Locates a single change-point in an annual series based on the Pettitt test.</p>
    </div>

    <pre class="usage"><span class='fu'>pett</span><span class='op'>(</span><span class='va'>x</span>, plot <span class='op'>=</span> <span class='cn'>FALSE</span>, order <span class='op'>=</span> <span class='cn'>FALSE</span>, pval <span class='op'>=</span> <span class='fl'>0.05</span>, pchs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>19</span>, <span class='fl'>21</span><span class='op'>)</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>a numeric vector, matrix or data frame with no missing interior
values</p></td>
    </tr>
    <tr>
      <th>plot</th>
      <td><p>Should the trends be plotted when x is a matrix?</p></td>
    </tr>
    <tr>
      <th>order</th>
      <td><p>Should the plotted trends be ordered by size?</p></td>
    </tr>
    <tr>
      <th>pval</th>
      <td><p>p-value for significance</p></td>
    </tr>
    <tr>
      <th>pchs</th>
      <td><p>Plot symbols for significant and not significant trend
estimates, respectively</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other arguments to pass to plotting function</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list of the following if <code>x</code> is a vector:</p>
<dt>pettitt.K</dt><dd><p>Pettitt's statistic</p></dd> <dt>p.value</dt><dd><p>significance
probability for statistic</p></dd> <dt>change.point</dt><dd><p>last position preceding
change to new level</p></dd> <dt>change.time</dt><dd><p>if available, time of change.point
position</p></dd> <dt>change.size</dt><dd><p>median of all differences between points after
and up to change.point</p></dd> or a matrix with corresponding columns if x
is a matrix or data frame.

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Pettitt's (1979) method is a rank-based nonparametric test for abrupt
changes in a time series. It uses the Mann-Whitney statistic for testing
that two samples (before and after the change-point) come from the same
distribution, choosing the change-point that maximizes the statistic. The
<em>p</em>-value is approximate but accurate to 0.01 for \(p \le\) 0.5.
Serial correlation is ignored, so the interval between points should be long
enough to avoid strong serial correlation. The size of the change is
estimated as the median difference between all pairs of observations in
which the first one is after the change-point and the second is up to the
change-point.</p>
<p>Missing values are allowed at the beginning or end of each variable but
interior missing values will produce an NA. Otherwise the change-point might
not be meaningful.</p>
<p>If <code>plot = TRUE</code>, a dot plot of <code>change.times</code> is shown. If
<code>sort = TRUE</code>, the dots are sorted by <code>change.time</code>. The plot
symbols indicate, respectively, that the trend is significant or not
significant. The plot can be customized by passing any arguments used by
<code><a href='https://rdrr.io/r/graphics/dotchart.html'>dotchart</a></code> such as <code>xlab</code>, as well as graphical parameters
described in <code><a href='https://rdrr.io/r/graphics/par.html'>par</a></code>.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>The <code>change.point</code> returned by these functions is the last
position before the series actually changes, for consistency with the
original Pettitt test. But for reporting purposes, the following position
might be more appropriate to call the &#8220;change-point&#8221;.</p>
<p>The Pettitt test produces a supposed change-point, even when the trend is
smooth, or when the abrupt change is smaller than the long-term smooth
change. Remove any smooth, long-term trend before applying this test.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Pettitt, A. N. (1979) A non-parametric approach to the
change-point problem. <em>Journal of the Royal Statistical Society. Series
C (Applied Statistics)</em> <b>28(2),</b> 126--135.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Alan Jassby, James Cloern</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'># data from Pettitt (1979, Table 1):</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1.05</span>, <span class='fl'>0.96</span>, <span class='fl'>1.22</span>, <span class='fl'>0.58</span>, <span class='op'>-</span><span class='fl'>0.98</span>, <span class='op'>-</span><span class='fl'>0.03</span>, <span class='op'>-</span><span class='fl'>1.54</span>, <span class='op'>-</span><span class='fl'>0.71</span>, <span class='op'>-</span><span class='fl'>0.35</span>, <span class='fl'>0.66</span>, 
<span class='fl'>0.44</span>, <span class='fl'>0.91</span>, <span class='op'>-</span><span class='fl'>0.02</span>, <span class='op'>-</span><span class='fl'>1.42</span>, <span class='fl'>1.26</span>, <span class='op'>-</span><span class='fl'>1.02</span>, <span class='op'>-</span><span class='fl'>0.81</span>, <span class='fl'>1.66</span>, <span class='fl'>1.05</span>, <span class='fl'>0.97</span>, <span class='fl'>2.14</span>, <span class='fl'>1.22</span>, 
<span class='op'>-</span><span class='fl'>0.24</span>, <span class='fl'>1.60</span>, <span class='fl'>0.72</span>, <span class='op'>-</span><span class='fl'>0.12</span>, <span class='fl'>0.44</span>, <span class='fl'>0.03</span>, <span class='fl'>0.66</span>, <span class='fl'>0.56</span>, <span class='fl'>1.37</span>, <span class='fl'>1.66</span>, <span class='fl'>0.10</span>, <span class='fl'>0.80</span>, 
<span class='fl'>1.29</span>, <span class='fl'>0.49</span>, <span class='op'>-</span><span class='fl'>0.07</span>, <span class='fl'>1.18</span>, <span class='fl'>3.29</span>, <span class='fl'>1.84</span><span class='op'>)</span>
<span class='fu'>pett</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span> <span class='co'># K=232, p=0.0146, change-point=17, the same results as Pettitt</span>
</div><div class='output co'>#&gt; $pettitt.K
#&gt; [1] 232
#&gt; 
#&gt; $p.value
#&gt; [1] 0.0146
#&gt; 
#&gt; $change.point
#&gt; [1] 17
#&gt; 
#&gt; $change.time
#&gt; [1] 17
#&gt; 
#&gt; $change.size
#&gt; [1] 1.07
#&gt; </div><div class='input'><span class='co'># identify the year of a change-point in an annual time series:</span>
<span class='fu'>pett</span><span class='op'>(</span><span class='va'>Nile</span><span class='op'>)</span>
</div><div class='output co'>#&gt; $pettitt.K
#&gt; [1] 1617
#&gt; 
#&gt; $p.value
#&gt; [1] 3.59e-07
#&gt; 
#&gt; $change.point
#&gt; [1] 28
#&gt; 
#&gt; $change.time
#&gt; [1] 1898
#&gt; 
#&gt; $change.size
#&gt; [1] -260
#&gt; </div><div class='input'><span class='co'># apply to a matrix time series:</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/ts.union.html'>ts.intersect</a></span><span class='op'>(</span><span class='va'>Nile</span>, <span class='va'>LakeHuron</span><span class='op'>)</span>
<span class='fu'>pett</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>
</div><div class='output co'>#&gt;           pettitt.K  p.value change.point change.time change.size
#&gt; Nile           1362 7.83e-06           24        1898     -255.50
#&gt; LakeHuron      1532 2.88e-07           46        1920       -1.54</div><div class='input'><span class='fu'>pett</span><span class='op'>(</span><span class='va'>y</span>, plot <span class='op'>=</span> <span class='cn'>TRUE</span>, xlab <span class='op'>=</span> <span class='st'>"Change-point"</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span><span class='st'>"topleft"</span>, legend <span class='op'>=</span> <span class='st'>"p &lt; 0.05"</span>, pch <span class='op'>=</span> <span class='fl'>19</span>, bty<span class='op'>=</span><span class='st'>"n"</span><span class='op'>)</span>
</div><div class='img'><img src='pett-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># note how a smooth trend can disguise a change-point:</span>
<span class='co'># smooth trend with change-point at 75</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>100</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>75</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>10</span>, <span class='fl'>25</span><span class='op'>)</span><span class='op'>)</span> 
<span class='fu'>pett</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span> <span class='co'># gives 50, erroneously</span>
</div><div class='output co'>#&gt; $pettitt.K
#&gt; [1] 2500
#&gt; 
#&gt; $p.value
#&gt; [1] 1.5e-16
#&gt; 
#&gt; $change.point
#&gt; [1] 50
#&gt; 
#&gt; $change.time
#&gt; [1] 50
#&gt; 
#&gt; $change.size
#&gt; [1] 55
#&gt; </div><div class='input'><span class='fu'>pett</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/residuals.html'>residuals</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/AsIs.html'>I</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>100</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># removing trend gives 75, correctly</span>
</div><div class='output co'>#&gt; $pettitt.K
#&gt; [1] 1743
#&gt; 
#&gt; $p.value
#&gt; [1] 2.9e-08
#&gt; 
#&gt; $change.point
#&gt; [1] 75
#&gt; 
#&gt; $change.time
#&gt; [1] 75
#&gt; 
#&gt; $change.size
#&gt; [1] 4.374437
#&gt; </div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Alan Jassby, Jemma Stachelek.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


