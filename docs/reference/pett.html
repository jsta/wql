<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Nonparametric Change-Point Detection — pett • wql</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Nonparametric Change-Point Detection — pett"><meta property="og:description" content="Locates a single change-point in an annual series based on the Pettitt test."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wql</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/wql-package.html">wql: Exploring water quality monitoring data</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/jsta/wql/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Nonparametric Change-Point Detection</h1>
    <small class="dont-index">Source: <a href="https://github.com/jsta/wql/blob/HEAD/R/pett.R" class="external-link"><code>R/pett.R</code></a></small>
    <div class="hidden name"><code>pett.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Locates a single change-point in an annual series based on the Pettitt test.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pett</span><span class="op">(</span><span class="va">x</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, order <span class="op">=</span> <span class="cn">FALSE</span>, pval <span class="op">=</span> <span class="fl">0.05</span>, pchs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="fl">21</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>a numeric vector, matrix or data frame with no missing interior
values</p></dd>


<dt>plot</dt>
<dd><p>Should the trends be plotted when x is a matrix?</p></dd>


<dt>order</dt>
<dd><p>Should the plotted trends be ordered by size?</p></dd>


<dt>pval</dt>
<dd><p>p-value for significance</p></dd>


<dt>pchs</dt>
<dd><p>Plot symbols for significant and not significant trend
estimates, respectively</p></dd>


<dt>...</dt>
<dd><p>Other arguments to pass to plotting function</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list of the following if <code>x</code> is a vector:</p>
<dl><dt>pettitt.K</dt>
<dd><p>Pettitt's statistic</p></dd>
 <dt>p.value</dt>
<dd><p>significance
probability for statistic</p></dd>
 <dt>change.point</dt>
<dd><p>last position preceding
change to new level</p></dd>
 <dt>change.time</dt>
<dd><p>if available, time of change.point
position</p></dd>
 <dt>change.size</dt>
<dd><p>median of all differences between points after
and up to change.point</p></dd>
</dl><p>or a matrix with corresponding columns if <code>x</code></p>


<p>is a matrix or data frame.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Pettitt's (1979) method is a rank-based nonparametric test for abrupt
changes in a time series. It uses the Mann-Whitney statistic for testing
that two samples (before and after the change-point) come from the same
distribution, choosing the change-point that maximizes the statistic. The
<em>p</em>-value is approximate but accurate to 0.01 for \(p \le\) 0.5.
Serial correlation is ignored, so the interval between points should be long
enough to avoid strong serial correlation. The size of the change is
estimated as the median difference between all pairs of observations in
which the first one is after the change-point and the second is up to the
change-point.</p>
<p>Missing values are allowed at the beginning or end of each variable but
interior missing values will produce an NA. Otherwise the change-point might
not be meaningful.</p>
<p>If <code>plot = TRUE</code>, a dot plot of <code>change.times</code> is shown. If
<code>sort = TRUE</code>, the dots are sorted by <code>change.time</code>. The plot
symbols indicate, respectively, that the trend is significant or not
significant. The plot can be customized by passing any arguments used by
<code><a href="https://rdrr.io/r/graphics/dotchart.html" class="external-link">dotchart</a></code> such as <code>xlab</code>, as well as graphical parameters
described in <code><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></code>.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>The <code>change.point</code> returned by these functions is the last
position before the series actually changes, for consistency with the
original Pettitt test. But for reporting purposes, the following position
might be more appropriate to call the “change-point”.</p>
<p>The Pettitt test produces a supposed change-point, even when the trend is
smooth, or when the abrupt change is smaller than the long-term smooth
change. Remove any smooth, long-term trend before applying this test.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Pettitt, A. N. (1979) A non-parametric approach to the
change-point problem. <em>Journal of the Royal Statistical Society. Series
C (Applied Statistics)</em> <b>28(2),</b> 126--135.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Alan Jassby, James Cloern</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># data from Pettitt (1979, Table 1):</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.05</span>, <span class="fl">0.96</span>, <span class="fl">1.22</span>, <span class="fl">0.58</span>, <span class="op">-</span><span class="fl">0.98</span>, <span class="op">-</span><span class="fl">0.03</span>, <span class="op">-</span><span class="fl">1.54</span>, <span class="op">-</span><span class="fl">0.71</span>, <span class="op">-</span><span class="fl">0.35</span>, <span class="fl">0.66</span>, </span></span>
<span class="r-in"><span><span class="fl">0.44</span>, <span class="fl">0.91</span>, <span class="op">-</span><span class="fl">0.02</span>, <span class="op">-</span><span class="fl">1.42</span>, <span class="fl">1.26</span>, <span class="op">-</span><span class="fl">1.02</span>, <span class="op">-</span><span class="fl">0.81</span>, <span class="fl">1.66</span>, <span class="fl">1.05</span>, <span class="fl">0.97</span>, <span class="fl">2.14</span>, <span class="fl">1.22</span>, </span></span>
<span class="r-in"><span><span class="op">-</span><span class="fl">0.24</span>, <span class="fl">1.60</span>, <span class="fl">0.72</span>, <span class="op">-</span><span class="fl">0.12</span>, <span class="fl">0.44</span>, <span class="fl">0.03</span>, <span class="fl">0.66</span>, <span class="fl">0.56</span>, <span class="fl">1.37</span>, <span class="fl">1.66</span>, <span class="fl">0.10</span>, <span class="fl">0.80</span>, </span></span>
<span class="r-in"><span><span class="fl">1.29</span>, <span class="fl">0.49</span>, <span class="op">-</span><span class="fl">0.07</span>, <span class="fl">1.18</span>, <span class="fl">3.29</span>, <span class="fl">1.84</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">pett</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="co"># K=232, p=0.0146, change-point=17, the same results as Pettitt</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $pettitt.K</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 232</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $p.value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.0146</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $change.point</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $change.time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $change.size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># identify the year of a change-point in an annual time series:</span></span></span>
<span class="r-in"><span><span class="fu">pett</span><span class="op">(</span><span class="va">Nile</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $pettitt.K</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1617</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $p.value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3.59e-07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $change.point</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 28</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $change.time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1898</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $change.size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -260</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># apply to a matrix time series:</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.union.html" class="external-link">ts.intersect</a></span><span class="op">(</span><span class="va">Nile</span>, <span class="va">LakeHuron</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">pett</span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           pettitt.K  p.value change.point change.time change.size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Nile           1362 7.83e-06           24        1898     -255.50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> LakeHuron      1532 2.88e-07           46        1920       -1.54</span>
<span class="r-in"><span><span class="fu">pett</span><span class="op">(</span><span class="va">y</span>, plot <span class="op">=</span> <span class="cn">TRUE</span>, xlab <span class="op">=</span> <span class="st">"Change-point"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend <span class="op">=</span> <span class="st">"p &lt; 0.05"</span>, pch <span class="op">=</span> <span class="fl">19</span>, bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="pett-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># note how a smooth trend can disguise a change-point:</span></span></span>
<span class="r-in"><span><span class="co"># smooth trend with change-point at 75</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">75</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu">pett</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="co"># gives 50, erroneously</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $pettitt.K</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2500</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $p.value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.5e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $change.point</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $change.time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $change.size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 55</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu">pett</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># removing trend gives 75, correctly</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $pettitt.K</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1743</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $p.value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2.9e-08</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $change.point</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 75</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $change.time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 75</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $change.size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 4.374437</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Alan Jassby, Jemma Stachelek.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

      </footer></div>

  


  

  </body></html>

